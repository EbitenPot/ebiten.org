<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    
    <meta name="description" content="Ebiten is an open-source game library, with which you can develop 2D games with simple API for multi platforms in the Go programming language.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#db5620">
    <meta property="og:title" content="Matrix in Ebiten - Ebiten">
    <meta property="og:site_name" content="Ebiten - A dead simple 2D game library in Go">
    <meta property="og:image" content="https://ebiten.org/images/share.png">
    <meta property="og:description" content="Ebiten is an open-source game library, with which you can develop 2D games with simple API for multi platforms in the Go programming language.">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@hajimehoshi">
    <meta name="twitter:title" content="Matrix in Ebiten - Ebiten">
    <meta name="twitter:description" content="Ebiten is an open-source game library, with which you can develop 2D games with simple API for multi platforms in the Go programming language.">
    <meta name="twitter:image" content="https://ebiten.org/images/share.png">
    <title>Matrix in Ebiten - Ebiten</title>
    <link rel="canonical" href="https://ebiten.org/documents/matrix.html">
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700%7cRoboto+Mono:400,700&amp;display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/styles/normalize.min.css">
    <link rel="stylesheet" type="text/css" href="/styles/style.css">
    <link rel="icon" href="/images/favicon.png" type="image/png">
    
    <script src="/scripts/script.js" defer></script>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-83252440-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-83252440-1');
    </script>
  </head>
  <body>
    <input type="checkbox" id="sidemenu"><label for="sidemenu" class="sidemenubutton"></label><label for="sidemenu" class="sidemenucover"></label>
    <nav>
      <h1><a href="/">Ebiten</a></h1>
      <ul>
        <li><a href="/">Home</a></li>
        <li><a href="https://github.com/hajimehoshi/ebiten">GitHub project</a></li>
        <li><a href="https://godoc.org/github.com/hajimehoshi/ebiten">API reference</a></li>
        <li><a href="/documents/">Documents</a></li>
        <li><a href="/examples/">Examples</a></li>
        <li><a href="/blog/">Blog</a></li>
      </ul>
      <h2>Documents</h2>
<h3>Getting Started</h3>
<ul>
  <li><a href="./install.html">Install</a></li>
  <li><a href="./helloworld.html">Hello, World!</a></li>
</ul>
<h3>Graphics</h3>
<ul>
  <li><a href="./fill.html">Fill</a></li>
  <li><a href="./renderimage.html">Render an Image</a></li>
  <li><a href="./geometrymatrix.html">Geometry Matrix</a></li>
  <li><a href="#">Filter (TBD)</a></li>
  <li><a href="#">Offscreen (TBD)</a></li>
  <li><a href="#">Color Matrix (TBD)</a></li>
  <li><a href="#">Tiling (TBD)</a></li>
</ul>
<h3>Input</h3>
<ul>
  <li><a href="#">Keyboard (TBD)</a></li>
  <li><a href="#">Mouse (TBD)</a></li>
  <li><a href="#">Gamepad (TBD)</a></li>
</ul>
<h3>Building</h3>
<ul>
  <li><a href="./mobile.html">Mobile</a></li>
  <li><a href="./webassembly.html">WebAssembly</a></li>
  <li><a href="./gopherjs.html">GopherJS</a></li>
</ul>
<h3>Tips</h3>
<ul>
  <li><a href="./cheatsheet.html">Cheat Sheet</a></li>
  <li><a href="./faq.html">FAQ</a></li>
  <li><a href="./performancetips.html">Performance Tips</a></li>
  <li><a href="./packages.html">Packages</a></li>
  <li><a href="./matrix.html">Matrix in Ebiten</a></li>
  <li><a href="./implementation.html">Implementation</a></li>
</ul>

    </nav>
    <main>
      <article>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<h1>Matrix in Ebiten</h1>
<p>This article explains what are matrices and how they are used in Ebiten. We don't explain a strict mathematical theory. Instead, we explain essential knowledge for Ebiten.</p>
<h2>Coordinate System</h2>
<div class="grid-container">
  <div class="grid-item-2">
    <p>Ebiten treats 2D graphics, and defines a coordinate system. X axis is rightward, and Y axis is downward. The origin point is upper left.</p>
    <p>The coordinate system exists for each <code>ebiten.Image</code> object. The upper left point of the destination image is the origin point of the coordinate system.</p>
  </div>
  <div class="grid-item-2">
    <figure>
      <p class="img"><img src="/images/documents/matrix/axes.png" width="456"></p>
    </figure>
    <figcaption>A coordinate system in Ebiten. Be careful that Y axis is downward.</figcaption>
  </div>
</div>
<h2>Matrix</h2>
<div class="grid-container">
  <div class="grid-item-2">
    <p><code>ebiten.Image</code> is a set of pixels on a 2D rectangle. In Ebiten, you can apply a conversion rule for each pixel. By the conversion rule, you can put an image at a specified position, and you can also apply various effects like scaling or rotating. As a conversion rule, Ebiten uses a matrix.</p>
    <p>In 2D space, a point is represented as a 2D vector $(x, y)$. A 2D matrix converts this and generates a new point.</p>
  </div>
  <div class="grid-item-2">
    <figure>
      <p class="img"><img src="/images/documents/matrix/conversion.png" width="456"></p>
    </figure>
    <figcaption>A conversion rule is applied to pixels of an image. As a result, the image is moved and/or transformed.</figcaption>
  </div>
</div>
<h3>Definition</h3>
<div class="grid-container">
  <div class="grid-item-2">
    <p>A matrix is used in linear algebra. A matrix is an array of numbers. A 2D matrix is like this.</p>
  </div>
  <div class="grid-item-2">
    <p class="mathjax">\begin{equation}
\begin{bmatrix}
  0.5000 & −0.8660 \\
  0.8660 & 0.5000  \\
\end{bmatrix}
\end{equation}</p>
  </div>
  <div class="grid-item-2">
    <p>The horizontal sequences are called rows, and the vertical sequences are called columns. If the size is 2, the matrix is called 2D (two-dimensional) matrix, and if 3, 3D (three-dimensional) matrrix. A 3D matrix is like this.</p>
  </div>
  <div class="grid-item-2">
    <p class="mathjax">\begin{equation}
\begin{bmatrix}
  0.2990  & 0.5870  & 0.1140  \\
  −0.1687 & −0.3313 & 0.5000  \\
  0.5000  & −0.4187 & −0.0813 \\
\end{bmatrix}
\end{equation}</p>
  </div>
  <div class="grid-item-2">
    <p>If the numbers of columns and rows are the same, the matrix is called a regular matrix. Ebiten treats only regular matrices.</p>
  </div>
</div>
<h3>Multiplying a matrix and a vector</h3>
<div class="grid-container">
  <div class="grid-item-2">
    <p>You can multiply a matrix and a vector. The matrix is on the left side and the vector is on the right side. In general, the swapped positions are also possible but Ebiten doesn't treat the swapped positions.</p>
    <p>A matrix is a conversion rule, and in the equation, $(x, y)$ means a point before converting, multiplying means applying the conversion rule, and $(ax+by, cx+dy)$ means a point after converting.</p>
  </div>
  <div class="grid-item-2">
    <p class="mathjax">\begin{equation}
\begin{bmatrix}
  a & b \\
  c & d \\
\end{bmatrix}
\begin{bmatrix}
  x \\
  y \\
\end{bmatrix}
=
\begin{bmatrix}
  ax + by \\
  cx + dy \\
\end{bmatrix}
\end{equation}</p>
  </div>
  <div class="grid-item-2">
    <p>By the way, this is same in the three-dimensional case.</p>
  </div>
  <div class="grid-item-2">
    <p class="mathjax">\begin{equation}
\begin{bmatrix}
  a & b & c \\
  d & e & f \\
  g & h & i \\
\end{bmatrix}
\begin{bmatrix}
  x \\
  y \\
  z \\
\end{bmatrix}
=
\begin{bmatrix}
  ax + by + cz \\
  dx + ey + fz \\
  gx + hy + iz \\
\end{bmatrix}
\end{equation}</p>
  </div>
</div>
<h3>Identity matrix</h3>
<div class="grid-container">
  <div class="grid-item-2">
    <p>An identity matrix is a matrix that doesn't change the multiplicand.</p>
  </div>
  <div class="grid-item-2">
    <p class="mathjax">\begin{equation}
\begin{bmatrix}
  1 & 0 \\
  0 & 1 \\
\end{bmatrix}
\end{equation}</p>
  </div>
  <div class="grid-item-2">
    <p>Let's multiply this identity matrix and a vector. You can confirm that the input and the output are the same. This matrix doesn't change any points on a 2D space.</p>
  </div>
  <div class="grid-item-2">
    <p class="mathjax">\begin{equation}
\begin{bmatrix}
  1 & 0 \\
  0 & 1 \\
\end{bmatrix}
\begin{bmatrix}
  x \\
  y \\
\end{bmatrix}
=
\begin{bmatrix}
  1 \cdot x + 0 \cdot y \\
  0 \cdot y + 1 \cdot y \\
\end{bmatrix}
=
\begin{bmatrix}
  x \\
  y \\
\end{bmatrix}
\end{equation}</p>
  </div>
</div>
<h3>Scaling</h3>
<div class="grid-container">
  <div class="grid-item-2">
    <p>A matrix that scales an image by $s_x$ times in X direction and by $s_y$ times in Y direction centering at the origin is this.</p>
  </div>
  <div class="grid-item-2">
    <p class="mathjax">\begin{equation}
\begin{bmatrix}
  s_x & 0   \\
  0   & s_y \\
\end{bmatrix}
\end{equation}</p>
    <figure>
      <p class="img"><img src="/images/documents/matrix/scale.png" width="456"></p>
    </figure>
    <figcaption>Scaling an image by a matrix.</figcaption>
  </div>
  <div class="grid-item-2">
    <p>Let's multiply this matrix and a vector.</p>
  </div>
  <div class="grid-item-2">
    <p class="mathjax">\begin{equation}
\begin{bmatrix}
  s_x & 0   \\
  0   & s_y \\
\end{bmatrix}
\begin{bmatrix}
  x \\
  y \\
\end{bmatrix}
=
\begin{bmatrix}
  s_x x \\
  s_y y \\
\end{bmatrix}
\end{equation}</p>
  </div>
</div>
<h3>Rotating</h3>
<div class="grid-container">
  <div class="grid-item-2">
    <p>A matrix that rotates an image by $\theta$ centering at the origin is this. This uses trigonometric functions. Please don't worry about trigonometric functions. Ebiten has a useful feature to rotate images by calling one function.</p>
  </div>
  <div class="grid-item-2">
    <p class="mathjax">\begin{equation}
\begin{bmatrix}
  \cos \theta & -\sin \theta \\
  \sin \theta & \cos \theta  \\
\end{bmatrix}
\end{equation}</p>
    <figure>
      <p class="img"><img src="/images/documents/matrix/rotate.png" width="456"></p>
    </figure>
    <figcaption>Rotating an image by a matrix.</figcaption>
  </div>
</div>
<h3>Multiplying a matrix and a matrix</h3>
<div class="grid-container">
  <div class="grid-item-2">
    <p>For example, what if you want to combine scaling and rotating? To come to the point, such combinations of conversion rules can be represented as one matrix. Let's see how two matrices are combined.</p>
  </div>
  <div class="grid-item-2">
  </div>
  <div class="grid-item-2">
    <p>If a vector is multiplied by two matrices, the equation will be like this.</p>
  </div>
  <div class="grid-item-2">
    <p class="mathjax">\begin{eqnarray}
\begin{bmatrix}
  a_2 & b_2 \\
  c_2 & d_2 \\
\end{bmatrix}
\begin{bmatrix}
  a_1 & b_1 \\
  c_1 & d_1 \\
\end{bmatrix}
\begin{bmatrix}
  x \\
  y \\
\end{bmatrix}
&=&
\begin{bmatrix}
  a_2 & b_2 \\
  c_2 & d_2 \\
\end{bmatrix}
\begin{bmatrix}
  a_1 x + b_1 y \\
  c_1 x + d_1 y \\
\end{bmatrix} \\
&=&
\begin{bmatrix}
  a_2(a_1 x + b_1 y) + b_2(c_1 x + d_1 y) \\
  c_2(a_1 x + b_1 y) + d_2(c_1 x + d_1 y) \\
\end{bmatrix} \\
&=&
\begin{bmatrix}
  (a_2 a_1 + b_2 c_1) x + (a_2 b_1 + b_2 d_1) y \\
  (c_2 a_1 + d_2 c_1) x + (c_2 b_1 + d_2 d_1) y \\
\end{bmatrix} \\
&=&
\begin{bmatrix}
  a_2 a_1 + b_2 c_1 & a_2 b_1 + b_2 d_1 \\
  c_2 a_1 + d_2 c_1 & c_2 b_1 + d_2 d_1 \\
\end{bmatrix} 
\begin{bmatrix}
  x \\
  y \\
\end{bmatrix} 
\end{eqnarray}</p>
  </div>
  <div class="grid-item-2">
    <p>What an intimidating equation! This equation means that we can define multiplying two matrices like this.</p>
  </div>
  <div class="grid-item-2">
    <p class="mathjax">\begin{equation}
\begin{bmatrix}
  a_2 & b_2 \\
  c_2 & d_2 \\
\end{bmatrix}
\begin{bmatrix}
  a_1 & b_1 \\
  c_1 & d_1 \\
\end{bmatrix}
=
\begin{bmatrix}
  a_2 a_1 + b_2 c_1 & a_2 b_1 + b_2 d_1 \\
  c_2 a_1 + d_2 c_1 & c_2 b_1 + d_2 d_1 \\
\end{bmatrix} 
\end{equation}</p>
  </div>
  <div class="grid-item-2">
    <p>Then, we were able to define the combination of matrices, and the result became a matrix. If you combine multiple convention rules, this will be represented as one matrix.</p>
    <p>You don't have to remember this equation, but please remember that multiplying two matrices results in one matrix.</p>
  </div>
  <div class="grid-item-2">
  </div>
  <div class="grid-item-2">
    <p>By the way, in three-dimensional cases, multiplying will be like this.</p>
  </div>
  <div class="grid-item-2">
    <p class="mathjax">\begin{eqnarray}
&
\begin{bmatrix}
  a_2 & b_2 & c_2 \\
  d_2 & e_2 & f_2 \\
  g_2 & h_2 & i_2 \\
\end{bmatrix}
\begin{bmatrix}
  a_1 & b_1 & c_1 \\
  d_1 & e_1 & f_1 \\
  g_1 & h_1 & i_1 \\
\end{bmatrix} \\
=&
\begin{bmatrix}
  a_2 a_1 + b_2 d_1 + c_2 d_1 & a_2 b_1 + b_2 e_1 + c_2 h_1 & a_2 c_1 + b_2 f_1 + c_2 i_1 \\
  d_2 a_1 + e_2 d_1 + f_2 d_1 & d_2 b_1 + e_2 e_1 + f_2 h_1 & d_2 c_1 + e_2 f_1 + f_2 i_1 \\
  g_2 a_1 + h_2 d_1 + i_2 d_1 & g_2 b_1 + h_2 e_1 + i_2 h_1 & g_2 c_1 + h_2 f_1 + i_2 i_1 \\
\end{bmatrix} 
\end{eqnarray}</p>
  </div>
  <div class="grid-item-2">
    <p>Be careful that the order of multilyping matters. If there is a matrix $A$ and a matrix $B$, the results of $AB$ and $BA$ are different in general. In the context of conversion rule, rotating and scaling an image in this order is different from scaling and rotating an image in this order in general.</p>
  </div>
  <div class="grid-item-2">
    <p>\begin{eqnarray}
\begin{bmatrix}
  1 & 2 \\
  3 & 4 \\
\end{bmatrix}
\begin{bmatrix}
  5 & 6 \\
  7 & 8 \\
\end{bmatrix}
&=&
\begin{bmatrix}
  19 & 22 \\
  43 & 50 \\
\end{bmatrix} \\
\begin{bmatrix}
  5 & 6 \\
  7 & 8 \\
\end{bmatrix}
\begin{bmatrix}
  1 & 2 \\
  3 & 4 \\
\end{bmatrix}
&=&
\begin{bmatrix}
  23 & 34 \\
  31 & 46 \\
\end{bmatrix} \\
\begin{bmatrix}
  1 & 2 \\
  3 & 4 \\
\end{bmatrix}
\begin{bmatrix}
  5 & 6 \\
  7 & 8 \\
\end{bmatrix}
&\ne&
\begin{bmatrix}
  5 & 6 \\
  7 & 8 \\
\end{bmatrix}
\begin{bmatrix}
  1 & 2 \\
  3 & 4 \\
\end{bmatrix}
\end{eqnarray}</p>
  </div>
</div>
<h3>Affine transformation</h3>
<div class="grid-container">
  <div class="grid-item-2">
    <p>A 2D matrix looks enough to move points, but there is a problem. Any 2D matrices cannot move the origin point $(0, 0)$.</p>
  </div>
  <div class="grid-item-2">
    <p class="mathjax">\begin{equation}
\begin{bmatrix}
  a & b \\
  c & d \\
\end{bmatrix}
\begin{bmatrix}
  0 \\
  0 \\
\end{bmatrix}
=
\begin{bmatrix}
  a \cdot 0 & b \cdot 0 \\
  c \cdot 0 & d \cdot 0 \\
\end{bmatrix}
=
\begin{bmatrix}
  0 \\
  0 \\
\end{bmatrix}
\end{equation}</p>
  </div>
  <div class="grid-item-2">
    <p>This means that the origin point will never be moved by any 2D matrices. So can't we represent translating by matrices?</p>
  </div>
  <div class="grid-item-2">
    <figure>
      <p class="img"><img src="/images/documents/matrix/origin.png" width="456"></p>
    </figure>
    <figcaption>Whatever matrices are applied to an image, the origin point stays at the same position.</figcaption>
  </div>
  <div class="grid-item-2">
    <p>Then, we introduce an affine transform matrix. For 2D vectors, an affine transform matrix is like this. The matrix is extended to be three-dimensional. The last row is always $(0, 0, 1)$.</p>
  </div>
  <div class="grid-item-2">
    <p class="mathjax">\begin{equation}
\begin{bmatrix}
  a & b & t_x \\
  c & d & t_y \\
  0 & 0 & 1 \\
\end{bmatrix}
\end{equation}</p>
  </div>
  <div class="grid-item-2">
    <p>The vector will also be extended to three dimensional, and the third value is always 1. A 2D vector $(x, y)$ will be $(x, y, 1)$.</p>
  </div>
  <div class="grid-item-2">
<p class="mathjax">\begin{equation}
\begin{bmatrix}
  x \\
  y \\
  1 \\
\end{bmatrix}
\end{equation}</p>
  </div>
</div>
<h3>Translating</h3>
<div class="grid-container">
  <div class="grid-item-2">
    <p>A matrix that just translates an image is this.</p>
  </div>
  <div class="grid-item-2">
    <p class="mathjax">\begin{equation}
\begin{bmatrix}
  1 & 0 & t_x \\
  0 & 1 & t_y \\
  0 & 0 & 1 \\
\end{bmatrix}
\end{equation}</p>
  </div>
  <div class="grid-item-2">
    <p>Let's apply this matrix to a vector $(x, y, 1)$. The result is translating $x$ and $y$ by $t_x$ and $t_y$ respectively. </p>
  </div>
  <div class="grid-item-2">
    <p class="mathjax">\begin{equation}
\begin{bmatrix}
  1 & 0 & t_x \\
  0 & 1 & t_y \\
  0 & 0 & 1 \\
\end{bmatrix}
\begin{bmatrix}
  x \\
  y \\
  1 \\
\end{bmatrix}
=
\begin{bmatrix}
  1 \cdot x + 0 \cdot y + t_x \cdot 1 \\
  0 \cdot x + 1 \cdot y + t_y \cdot 1 \\
  0 \cdot x + 0 \cdot y + 1 \cdot 1 \\
\end{bmatrix}
=
\begin{bmatrix}
  x + t_x \\
  y + t_y \\
  1 \\
\end{bmatrix}
\end{equation}</p>
    <figure>
      <p class="img"><img src="/images/documents/matrix/translate.png" width="456"></p>
    </figure>
    <figcaption>Translating an image by a matrix.</figcaption>
  </div>
  <div class="grid-item-2">
    <p>Scaling and rotating matrix we already explained will be a matrix that $t_x$ and $t_y$ are $0$.</p>
    <p>We don't prove this here, but multiplying two affine transform matrices results in an affine transform matrix. This means that any combinations of scaling, rotating and translating are represented as one affine matrix. Based on this fact, Ebiten's API for geometric transform is very simple and requires only one affine transform matrix. Ebiten's matrices are always affine transform, and doesn't treat other matrices.</p>
  </div>
</div>
<h2>Filter</h2>
<p>We explained that converting an image is represented by a matrix that moves each pixel of the image. You might already realize this, but as a matter of fact, enlarging this results in an image with full of holes, since the destination area is larger than the soruce area. To avoid an odd result, Ebiten complements pixels. The way in which the pixels are complemented is determined by a filter, like <a href="https://godoc.org/github.com/hajimehoshi/ebiten#Filter"><code>ebiten.FilterNearest</code> or <code>ebiten.FilterLinear</code></a></p>
<h2>Color matrix</h2>
<div class="grid-container">
  <div class="grid-item-2">
    <p>In Ebiten, matrices are also used when converting colors. We don't explain details here. Ebiten treats an RGBA color as a point in 4D space, and convert it with a matrix. The matrix is an affine transform matrix, and the dimension is 5.</p>
  </div>
  <div class="grid-item-2">
    <p class="mathjax">\begin{equation}
\begin{bmatrix}
  x_1 & x_2 & x_3 & x_4 & t_r \\
  x_5 & x_6 & x_7 & x_8 & t_g \\
  x_9 & x_{10} & x_{11} & x_{12} & t_b \\
  x_{13} & x_{14} & x_{15} & x_{16} & t_a \\
  0 & 0 & 0 & 0 & 1 \\
\end{bmatrix}
\begin{bmatrix}
  r \\
  g \\
  b \\
  a \\
  1 \\
\end{bmatrix}
\end{equation}</p>
  </div>
</div>
<h2>References</h2>
<ul>
  <li><a href="https://en.wikipedia.org/wiki/Matrix_(mathematics)">Matrix (mathematics) - Wikipedia</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Affine_transformation">Affine transformation - Wikipedia</a></li>
</ul>

      </article>
      <footer>
        <p>Feedback about this page? <a href="https://github.com/ebiten/ebiten.org/issues/new?body=https%3a%2f%2febiten.org%2fdocuments%2fmatrix.html%0a%0a">Please reach out on GitHub</a>. Thank you!</p>
      </footer>
    </main>
  </body>
</html>
